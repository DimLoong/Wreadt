
--- messages.ts ---
export type Locale = "zh-CN" | "en-US";

export const messages: Record<Locale, Record<string, string>> = {
  "zh-CN": {
    title: "Wreadt",
    subtitle: "输入即学习，启动即进入打字态",
    placeholder: "开始输入当前单词...",
    phoneticPage: "音标页",
    customVocab: "自定义词库",
    sentencePractice: "造句练习",
    progressView: "学习进度",
    settings: "设置",
    replayAudio: "播放发音",
    wordCorrect: "正确",
    wordWrong: "有误",
    expandable: "扩展学习区",
    nextWord: "下一个单词",
    sentenceEntry: "直接开始造句练习",
    skipAnimation: "跳过动画",
    mastered: "你掌握了 {{count}} 个单词",
    darkMode: "深色模式",
    language: "语言",
    hintTitle: "轻提示",
  },
  "en-US": {
    title: "Wreadt",
    subtitle: "Launch-ready typing learning",
    placeholder: "Start typing current word...",
    phoneticPage: "Phonetic Page",
    customVocab: "Custom Vocabulary",
    sentencePractice: "Sentence Practice",
    progressView: "Progress View",
    settings: "Settings",
    replayAudio: "Replay Audio",
    wordCorrect: "Correct",
    wordWrong: "Incorrect",
    expandable: "Expanded Learning",
    nextWord: "Next Word",
    sentenceEntry: "Start sentence practice now",
    skipAnimation: "Skip animation",
    mastered: "You have mastered {{count}} words",
    darkMode: "Dark mode",
    language: "Language",
    hintTitle: "Light Hint",
  },
};

export function t(locale: Locale, key: string, vars?: Record<string, string | number>): string {
  const template = messages[locale][key] ?? key;
  if (!vars) return template;
  return Object.entries(vars).reduce(
    (acc, [k, v]) => acc.replace(`{{${k}}}`, String(v)),
    template,
  );
}

--- youdao.ts ---
// 有道公开发音接口封装：仅构建 URL，避免把 API 调用耦合到组件。
// 英文/日文统一走 dictvoice，type=2 为美式/默认语音。

const audioCache = new Map<string, HTMLAudioElement>();

export function getYoudaoPronounceUrl(text: string, lang: "en" | "ja"): string {
  const le = lang === "ja" ? "ja" : "en";
  return `https://dict.youdao.com/dictvoice?audio=${encodeURIComponent(text)}&type=2&le=${le}`;
}

export async function preloadAudio(text: string, lang: "en" | "ja"): Promise<HTMLAudioElement> {
  const key = `${lang}:${text}`;
  const cached = audioCache.get(key);
  if (cached) return cached;

  const audio = new Audio(getYoudaoPronounceUrl(text, lang));
  audio.preload = "auto";
  audioCache.set(key, audio);
  return audio;
}

export async function playAudio(text: string, lang: "en" | "ja"): Promise<void> {
  const audio = await preloadAudio(text, lang);
  await audio.play();
}
